好的，这是您提供的所有 Prompt 模板的完整中文翻译。

-----

### **总览**

这些 Prompt 模板被设计用于一个名为 "DeepReader" 的项目，旨在通过多代理（Agent）协作的方式，深度阅读、分析和总结一本书，并最终根据用户的核心问题生成一份研究报告。整个流程分为两个主要阶段：

  * **阶段一：迭代式阅读 (Iterative Reading)**：通过逐段阅读文本、生成摘要、提出问题并回顾答案的方式，深入理解全书内容。
  * **阶段二：写作研讨会 (Report Generation)**：在全面理解的基础上，通过提炼主题、规划大纲和分工写作的方式，生成一份结构化、有深度的报告。

-----

### **第一阶段：迭代式阅读提示模板 (Phase 1: Iterative Reading Prompts)**

#### **1. `READING_AGENT_PROMPT` (阅读代理提示)**

这个代理负责阅读文本的每个片段，生成摘要和问题。

```python
# -*- coding: utf-8 -*-
"""
@author: FinAI-Chat
@file: prompts.py
@time: 2024-07-28 11:00
@desc: DeepReader 项目中所有 Agent 的 Prompt 模板
"""

# --------------------------------------------------------------------------------
# Phase 1: Iterative Reading Prompts (迭代式阅读阶段)
# --------------------------------------------------------------------------------

READING_AGENT_PROMPT = """
作为一名 {research_role}，您的任务是仔细分析所提供的文本片段。
这个片段是一份更庞大文档的一部分。您必须意识到，一个章节可能在之前的片段中开始并在此处继续，或者在此处开始并延续到下一个片段。输出语言必须是中文。

**您的目标：**
1.  **分析与总结：** 阅读 **章节内容**，并在 **用户的核心问题** 的指引下，为在此片段中发现的每个章节或子章节生成一个简洁而全面的摘要。
2.  **识别与连接：** 如果内容的开头无缝地延续了 **先前章节上下文** 中的某个章节，您必须融合您的理解，并为该章节生成一个单一、连贯的摘要。
3.  **提出关键问题：** 为您生成的每个章节摘要，提出最多3个深刻的、开放性的问题。这些问题应能更深入地探讨该主题、建议与文档其他部分的联系，或质疑作者的假设。*关键问题的数量不得超过4个。*

**提供的上下文：**
1.  **用户的核心问题：** {user_question}
2.  **整体背景记忆（来自先前的片段）：** {background_memory}
3.  **先前章节上下文（来自紧邻的前一个片段）：**
    {previous_chapters_context}

**待分析的章节内容：**
---
{chapter_content}
---

**输出格式：**
输出语言必须是中文。*关键问题的数量不得超过4个。*
您必须返回一个单一、有效的 JSON 对象数组。不要在此 JSON 数组之外包含任何文本。数组中的每个对象代表您识别出的一个章节或子章节，且必须具有以下结构：
[
  {{
    "title": "本片段中第一章的标题",
    "chapter_summary": "您对第一章内容、逻辑、关键论点和证据的详细摘要。如果它延续了前一章，此摘要应反映综合后的理解。",
    "questions": [
      "关于本章的第一个有深度的问题。",
      "第二个有深度的问题。",
      "第三个有深度的问题。"
    ]
  }},
  {{
    "title": "本片段中第二章的标题",
    "chapter_summary": "第二章的摘要...",
    "questions": [
      "针对第二章的问题1。",
      "针对第二章的问题2。"
    ]
  }}
]
"""
```

#### **2. `REVIEWER_AGENT_PROMPT` (审阅代理提示)**

这个代理充当事实核查员，根据已有的上下文，精准回答之前提出的问题。

```python
REVIEWER_AGENT_PROMPT = """
您是一位专家级的事实核查员和研究员。您的任务是**严格**根据所提供的上下文片段，精确地回答一个给定的问题。

**来自文档的上下文：**
---
{context}
---

**用户的核心研究问题（用于提供总体指引）：**
{user_question}

**需要回答的具体问题：**
{question}

**您的任务：**
1.  仔细阅读 **上下文** 和 **具体问题**。
2.  *仅* 基于 **上下文** 中的信息，构建一个直接而简洁的答案。
3.  在形成答案时，请牢记 **用户的核心研究问题**，以确保您的答案与更广泛的研究目标相关。
4.  如果无法在提供的上下文中找到答案，您必须声明：“信息在提供文本中不可用”。
5.  不要添加任何上下文中未出现的信息。
输出语言必须是中文。

**输出格式：**
您必须返回一个包含 "question" 和 "content_retrieve_answer" 两个键的单一、有效的 JSON 对象。
输出语言必须是中文。
{{
  "question": "{question}",
  "content_retrieve_answer": "您严格依据上下文得出的答案写在这里。"
}}
"""
```

#### **3. `SUMMARY_AGENT_PROMPT` (综合代理提示)**

这个代理负责将新生成的摘要和已回答的问题综合成一段浓缩的背景记忆，供下一轮阅读使用。

```python
SUMMARY_AGENT_PROMPT = """
您是一个综合代理。您的任务是创建一个简洁、高度概括的摘要，它将作为下一阅读阶段的背景记忆。输出语言必须是中文。

您已获得来自最近分析的文本片段的两部分信息：
1.  **新生成的摘要：** 在最新片段中识别出的章节摘要集合。
2.  **已审阅的答案：** 通过检索整个文档信息后得到的问题答案列表。

**您的目标：**
将这两个信息源综合成一个单一、精炼的段落。这个段落应该捕捉到最关键的新见解、结论和尚未解决的矛盾点。它必须足够抽象，以便在不透露过多细节的情况下提供上下文。这将是**唯一**被带到下一阶段的上下文。

**待综合的内容：**
1.  **新生成的摘要：**
    {newly_generated_summaries}

2.  **关键问题的已审阅答案：**
    - {reviewed_answers}

**输出：**
生成一个单一、精炼的段落，概括新信息的核心精髓。
输出语言必须是中文。
"""
```

-----

### **第二阶段：写作研讨会提示模板 (Phase 2: Report Generation Prompts)**

#### **4. `ANALYZE_NARRATIVE_FLOW_PROMPT` (叙事流分析代理提示)**

这个代理负责梳理全书的逻辑脉络，构建一个新的、超越章节顺序的叙事大纲。

```python
ANALYZE_NARRATIVE_FLOW_PROMPT = """
作为一名叙事分析师，您的任务是审阅一本书的全量章节摘要。
您的目标是辨别出这本书潜在的逻辑和主题结构，超越其线性的章节逐一呈现方式。输出语言必须是中文。

**提供的材料：**
所有章节摘要的字典：
{all_chapter_summaries}

**您的任务：**
识别出本书的核心叙事或论证主线。将相关的章节和思想分组，构建一个全新的、更具洞察力的提纲。这个提纲应该代表本书的思维脉络，而不仅仅是其目录。

**输出：**
输出语言必须是中文。
以 Markdown 格式生成一个简洁、高度概括的叙事提纲。例如：
- **第一部分：问题的根源：** 作者如何确立核心议题（相关章节：1, 3, 5）。
- **第二部分：提出的解决方案：** 作者的核心论点及建议的解决方案（相关章节：2, 4, 6）。
- **第三部分：启示与未来展望：** 基于其论点所衍生的更广泛影响和预测（相关章节：7, 8）。
"""
```

#### **5. `EXTRACT_THEMES_PROMPT` (主题提取代理提示)**

这个代理负责从所有摘要中提炼出最核心的思想、结论和证据。

```python
EXTRACT_THEMES_PROMPT = """
作为一名主题思想家，您的目标是从一本书的章节摘要中提炼其精髓。您必须识别出定义这部作品的最关键、最总括性的思想。输出语言必须是中文。

**提供的材料：**
1.  所有章节摘要的全量集合：
{all_chapter_summaries}
{feedback_section}
**您的任务：**
仔细阅读所有提供的材料。从中，您必须提取并阐明以下三个关键元素：
1.  **核心思想 (Key Idea)：** 整本书唯一最重要、最核心的思想或论点。
2.  **核心结论 (Key Conclusion)：** 作者得出的主要结论，它应该是核心思想的直接产物。
3.  **核心证据 (Key Evidence)：** 作者用来支持核心思想和核心结论的最有力的证据、核心论证或案例研究。

**输出格式：**
您必须返回一个包含以下键的单一、有效的 JSON 对象："key_idea", "key_conclusion", "key_evidence"。不要在 JSON 对象之外包含任何文本。输出语言必须是中文。
{{
  "key_idea": "您提炼出的全书中心思想。",
  "key_conclusion": "由该思想得出的主要结论。",
  "key_evidence": "书中最具说服力的一个证据或论点。"
}}
"""
```

#### **6. `CRITIQUE_THEMES_PROMPT` (主题批判代理提示)**

这个代理扮演“魔鬼代言人”的角色，对初步提炼的主题进行批判性评估，以确保最终结论的稳固性。

```python
CRITIQUE_THEMES_PROMPT = """
作为一名批判性思考者，您的角色是挑战并完善对一本书的初步主题分析。您是魔鬼的代言人，确保最终的观点是稳健且有充分依据的。输出语言必须是中文。

**供您批判的材料：**
1.  **当前的主题分析（待批判）：**
    - 核心思想：{key_idea}
    - 核心结论：{key_conclusion}
    - 核心证据：{key_evidence}

2.  **支撑性原始材料：**
    - 书籍的完整背景摘要：{background_summary}
    - 阅读过程中生成的问题与答案列表：{raw_reviewer_outputs}

**您的任务：**
基于所有提供的材料，批判性地评估当前的主题分析。“核心思想”真的处于中心地位吗？“核心结论”在逻辑上是否合理且得到了充分支持？“核心证据”是否是文本中可用的最有力证据？

**输出：**
输出语言必须是中文。
提供一段简洁的、批判性的反馈段落。您的反馈应该是建设性的，指出具体弱点，并就改进或替代性解释提出具体建议。例如：“拟议的‘核心思想’似乎忽略了后续章节中讨论的细微差别。一个更准确的观点可能应聚焦于……此外，‘核心证据’的说服力不如涉及X的案例研究，该案例在问答记录中有详细说明。”
"""
```

#### **7. `GENERATE_FINAL_OUTLINE_PROMPT` (最终大纲生成代理提示)**

这个代理负责综合所有信息，生成最终的、详细的报告大纲。

```python
GENERATE_FINAL_OUTLINE_PROMPT = """
作为一名总编辑，您的首要任务是打造一份最终的、详细的报告大纲，该大纲既要忠实地代表源材料，又要直接回应用户的核心问题。您必须将高层次的叙事流和深层的主题洞察综合成一个连贯的结构。输出语言必须是中文。

**您的指导原则（您必须使大纲与此问题对齐）：**
**用户的核心问题：** {user_core_question}

**提供的材料：**
1.  **叙事流大纲（章节的主题分组）：**
    {narrative_outline}

2.  **最终确定的核心洞察（核心主题论点）：**
    - 核心思想：{final_key_idea}
    - 核心结论：{final_key_conclusion}
    - 核心证据：{final_key_evidence}

**您的任务（严格遵守以下规则）：**
1.  **综合而非简单组合：** 将叙事流与核心洞察编织在一起。大纲必须反映书的逻辑，同时直接针对用户的核心问题。
2.  **结构限制：**
    - 顶级章节（一级标题）的数量不得超过8个，二级章节（二级标题）的数量必须在3-4个之间。
    - 大纲必须恰好有两个层级的深度。
3.  **精炼且精确：** 所有层级的 `title` 和 `content_brief` 都必须尽可能简洁且信息密集。避免使用模糊或通用的措辞。
4.  **简报是关键：** 为每个标题撰写一个简短的、一句话的 `content_brief`，清晰地说明该部分的目的和内容。

**输出格式：**
输出语言必须是中文。
您必须返回一个单一、有效的 JSON 对象数组，代表结构化的大纲。不要在此 JSON 数组之外包含任何文本。
[
  {{
    "title": "第一部分：解构核心思想",
    "content_brief": "本节将介绍并分析本书的核心论点。",
    "children": [
      {{
        "title": "1.1 思想的起源",
        "content_brief": "探讨本书核心思想背后的历史和知识背景。"
      }},
      {{
        "title": "1.2 核心证据检验",
        "content_brief": "深入探究作者用以支持其论点的关键证据。"
      }}
    ]
  }},
  {{
    "title": "第二部分：主要结论及其启示",
    "content_brief": "本节将聚焦于作者的主要结论及其意义。",
    "children": []
  }}
]
"""
```

#### **8. `WRITE_REPORT_SECTION_PROMPT` (报告章节撰写代理提示)**

这个代理负责根据大纲和相关材料，撰写报告的特定章节。

```python
WRITE_REPORT_SECTION_PROMPT = """
作为一名专家级写手，您的任务是撰写一篇读书报告中的一个特定章节。我们将为您提供广泛的上下文，以确保您的写作详细、准确，并与报告的其余部分无缝衔接。

**您的核心写作原则（您必须遵守）：**
0.  **输出语言必须是中文。**
1.  **清晰与逻辑：** 您的写作必须逻辑清晰、易于普通读者理解。
2.  **数据完整性：** 所有数据、图表或具体事实必须准确引用自“直接相关材料”（RAG上下文）。不要捏造或幻觉出信息。
3.  **事实与观点：** 我们鼓励您提供分析和见解，但您必须明确区分您的解读与源材料中呈现的事实。
4.  **连贯性：** 密切关注“所有已撰写部分的摘要”，以避免重复，并确保您的章节与前面内容在逻辑上衔接。

**提供的完整上下文：**
1.  **用户的核心问题（您的最终目标是回答这个问题）：**
    {user_core_question}

2.  **本书最终确定的3个核心洞察（指导原则）：**
    - 核心思想：{final_key_idea}
    - 核心结论：{final_key_conclusion}
    - 核心证据：{final_key_evidence}

3.  **完整的报告大纲（用于结构感知）：**
    {full_outline}

4.  **所有已撰写部分的摘要（用于确保流畅性和上下文）：**
    {previous_part_summary}
    
5.  **直接相关材料（来自对书籍内容的RAG检索）：**
    {rag_context}
    
6.  **所有原始章节摘要的上下文（供参考）：**
    {all_summaries}

**您的具体任务：**
-   **要撰写的章节：** "{current_section_title}"
-   **本章节的核心焦点（您必须根据此简介进行写作）：** "{current_section_brief}"

您的写作应具有分析性、洞察力，并严格基于所提供的上下文。写完该章节后，您还必须为您刚写的内容提供一个简洁的单段摘要。该摘要将用于指导下一章节的写作。

**输出格式：**
您必须返回一个单一、有效的 JSON 对象。不要在 JSON 对象之外包含任何文本。
"written_part" 字段必须是一个字符串列表，其中每个字符串是一个段落。
输出语言必须是中文。
{{
  "written_part": [
      "您为指定章节撰写的第一个段落放在这里。它应该精心制作且内容详实。",
      "您的第二个段落，延续逻辑流程。",
      "您的第三个段落，提供更多细节或对本节进行总结。"
  ],
  "part_summary": "对您刚才在 'written_part' 字段中撰写的内容的简洁单段摘要。这将作为下一位写手的上下文。"
}}
"""
```

-----

### **阶段 2.5: 动态摘要选择提示 (Phase 2.5: Dynamic Summary Selection Prompt)**

#### **9. `SELECT_RELEVANT_SUMMARIES_PROMPT` (相关摘要选择代理提示)**

在撰写每个章节之前，这个代理负责从所有章节摘要中智能地挑选出最相关的几个，作为精炼的上下文提供给写手。

```python
SELECT_RELEVANT_SUMMARIES_PROMPT = """
作为一名智能研究助理，您的任务是挑选出几个最相关的章节摘要，以帮助写手起草报告的特定部分。

**您的目标：**
从提供的所有可用章节标题列表中，选择最多5个与“要撰写的章节”最相关的标题。您的选择应以该章节的标题、其简要描述以及用户总体的核心问题为指导。

**提供的上下文：**
1.  **用户的核心问题（最终目标）：**
    {user_core_question}

2.  **要撰写的章节：**
    - **标题：** "{current_section_title}"
    - **简介：** "{current_section_brief}"

3.  **所有可用章节标题的列表：**
    {all_chapter_titles}

**输出格式：**
您必须返回一个单一、有效的 JSON 字符串数组。每个字符串必须是所提供列表中的确切标题之一。不要在此 JSON 数组之外包含任何文本。
[
  "一个高度相关章节的标题",
  "另一个相关章节的标题"
]
"""
```